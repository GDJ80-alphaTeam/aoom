<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.alpha.aoom.review.service.ReviewMapper">
	<!-- 컬럼 이름 sql조각 -->
	<sql id="review_col">
		booking_id
       ,room_id
       ,user_id
       ,review_content
       ,review_image
       ,original_name
       ,create_date
	</sql>
	
	<!-- 숙소 리뷰 목록 조회-->
	<select id="selectByRoomList" parameterType="map" resultType="camelCaseMap">
		SELECT
            *
        FROM
        (
            SELECT 
                 ROWNUM as rn 
                ,<include refid="review_col"/>
            FROM (
                SELECT 
                    <include refid="review_col"/>
                FROM 
                    review
                WHERE 
                    room_id = #{roomId}		 
                ORDER BY create_date DESC  
            )  
         )	
         WHERE
			rn <![CDATA[>]]> #{beginRow} and rn <![CDATA[<=]]> #{endRow} 
	</select>
	
	<select id="selectByAverageCount" parameterType="map" resultType="camelCaseMap">
		SELECT 
			 count(*) AS cnt
			,avg(rating) AS avg		
		FROM 
			review
		WHERE 
			room_id = #{roomId}	
	</select>
</mapper>